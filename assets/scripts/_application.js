// Generated by CoffeeScript 1.4.0
/*jshint plusplus:false, forin:false, eqeqeq:false
*//*global Class, dat
*/"use strict";var AnimationLoop,Config,Game,HeadsUp,Input,Particle,ParticleGenerator,Scenes,Utils,android,animationLoop,animationLoopId,backingStoreRatio,canvas,config,context,debug,devicePixelRatio,game,headsUp,homeScreenApp,iOS,input,oldHeight,oldWidth,particleGenerator,ratio,scenes,utils;android=navigator.userAgent.match(/android/i)?!0:!1;iOS=navigator.userAgent.match(/(iPad|iPhone|iPod)/i)?!0:!1;homeScreenApp=iOS&&navigator.standalone;debug=!0;animationLoopId=null;canvas=document.createElement("canvas");context=canvas.getContext("2d");document.body.appendChild(canvas);canvas.width=document.width;canvas.height=document.height;devicePixelRatio=window.devicePixelRatio||1;backingStoreRatio=context.webkitBackingStorePixelRatio||context.backingStorePixelRatio||1;ratio=devicePixelRatio/backingStoreRatio;if(devicePixelRatio!==backingStoreRatio){oldWidth=canvas.width;oldHeight=canvas.height;canvas.width=oldWidth*ratio;canvas.height=oldHeight*ratio;canvas.style.width=oldWidth+"px";canvas.style.height=oldHeight+"px";context.scale(ratio,ratio)}AnimationLoop=Class.extend({init:function(){},cancelAnimationFrame:function(){window.cancelAnimationFrame(animationLoopId)},requestAnimationFrame:function(){var e;e=this;animationLoopId=window.requestAnimationFrame(function(){e.requestAnimationFrame()});canvas.width=canvas.width;particleGenerator.generateParticle(1);particleGenerator.updateValuesAndDraw();particleGenerator.destroyParticlesOutsideCanvasBounds()}});Config=Class.extend({init:function(){this.particleSpawnChance=100;this.chanceParticleIsTarget=5;this.particleGrowthMultiplier=1.05;this.maxLineWidth=10;this.levelUpInterval=15;this.maxLevel=50;this.pointsPerPop=10;this.sizeMin=0;this.sizeMax=70;this.minTargetSize=40;this.velocityMin=-5;this.velocityMax=5;this.targetVelocityMultiplier=.3},setupDatGui:function(){var e,t,n,r;t=new dat.GUI;e=t.addFolder("Environment");e.add(this,"chanceParticleIsTarget",0,100);e.add(this,"particleSpawnChance",0,100);e.add(this,"maxLineWidth");n=t.addFolder("Size");n.add(this,"minTargetSize",40);n.add(this,"sizeMin",0);n.add(this,"sizeMax",70);r=t.addFolder("Velocity");r.add(this,"targetVelocityMultiplier",.3);r.add(this,"velocityMin",-5);r.add(this,"velocityMax",5)}});Game=Class.extend({init:function(){debug&&config.setupDatGui()},run:function(){animationLoop.requestAnimationFrame();headsUp.setToInitialValues();scenes.title()},reset:function(){headsUp.reset();particleGenerator.reset()},start:function(){particleGenerator.start()}});HeadsUp=Class.extend({init:function(){this.levelCounter=".level";this.scoreCounter=".score";this.comboMultiplierCounter=".combo";this.tapX=".tapX";this.tapY=".tapY"},reset:function(){window.clearInterval(this.levelUpCounter)},setToInitialValues:function(){var e;e=this;this.level=1;this.score=0;this.comboMultiplier=1;utils.updateUITextNode(this.levelCounter,this.level);utils.updateUITextNode(this.scoreCounter,this.score);utils.updateUITextNode(this.comboMultiplierCounter,this.comboMultiplier);this.levelUpCounter=window.setInterval(function(){e.updateLevel()},config.levelUpInterval*1e3)},updateComboMultiplierCounter:function(e){headsUp.comboMultiplier=e;utils.updateUITextNode(this.comboMultiplierCounter,this.comboMultiplier)},updateLevel:function(){this.level+=1;utils.updateUITextNode(this.levelCounter,this.level);this.level>=config.maxLevel&&window.clearInterval(this.levelUpCounter)},updateScore:function(e,t){var n,r,i;i=Math.round(100-e/t*100);r=config.pointsPerPop+i;n=this.level+1;this.score+=r*this.comboMultiplier*n;utils.updateUITextNode(this.scoreCounter,this.score)}});Input=Class.extend({init:function(){window.addEventListener("touchmove",function(e){return e.preventDefault()})}});Particle=Class.extend({init:function(){var e,t;t=this;e={r:utils.randomInteger(0,255),g:utils.randomInteger(0,255),b:utils.randomInteger(0,255),a:utils.random(.8,1)};this.color="rgba("+e.r+", "+e.g+", "+e.b+", "+e.a+")";this.size=1;this.finalSize=utils.randomInteger(config.sizeMin,config.sizeMax);this.half=Math.round(this.size/2);this.position={x:particleGenerator.particlesOrigin.x,y:particleGenerator.particlesOrigin.y};this.velocity={x:utils.random(config.velocityMin,config.velocityMax),y:utils.random(config.velocityMin,config.velocityMax)};this.id=Math.random().toString(36).substr(2,5);this.isTarget=this.determineTargetParticle();if(this.isTarget){this.color="rgba("+e.r+", "+e.g+", "+e.b+", 1)";this.velocity.x=this.velocity.x*config.targetVelocityMultiplier;this.velocity.y=this.velocity.y*config.targetVelocityMultiplier;this.lineWidth=1;particleGenerator.particlesToTestForTaps.push(this.id)}},determineTargetParticle:function(){if(this.finalSize>=config.minTargetSize)return Math.floor(Math.random()*101)<config.chanceParticleIsTarget},draw:function(){if(this.withinCanvasBounds()){context.beginPath();context.arc(this.position.x,this.position.y,this.half,0,Math.PI*2,!0);if(this.isTarget){context.fillStyle="rgb(255, 255, 255)";context.lineWidth=this.lineWidth;context.stroke();this.lineWidth<config.maxLineWidth?this.lineWidth=this.lineWidth*1.1:this.lineWidth>config.maxLineWidth&&(this.lineWidth=config.maxLineWidth)}context.fill();context.closePath()}else particleGenerator.particlesToDelete.push(this.id)},updateValues:function(){this.size<this.finalSize&&(this.size=this.size*config.particleGrowthMultiplier);this.size>this.finalSize&&(this.size=this.finalSize);this.half=Math.round(this.size/2);this.position.x+=this.velocity.x;this.position.y+=this.velocity.y},withinCanvasBounds:function(){var e,t;e=this.position.x<-this.size||this.position.x>canvas.width+this.size;t=this.position.y<-this.size||this.position.y>canvas.height+this.size;return!e&&!t}});ParticleGenerator=Class.extend({init:function(){this.particlesOrigin={x:canvas.width/2,y:canvas.height/2};this.particlesArray=[];this.particlesArrayIds=[];this.particlesToDelete=[];this.particlesToTestForTaps=[];this.setupParticleTapDetection()},destroyParticlesOutsideCanvasBounds:function(){var e,t,n,r,i,s;s=this.particlesToDelete;for(r=0,i=s.length;r<i;r++){t=s[r];n=this.particlesArrayIds.indexOf(t);e=this.particlesArray[n];e.isTarget&&scenes.gameOver();this.removeParticle(n)}this.particlesToDelete=[]},generateParticle:function(e){var t,n,r;for(n=r=e;e<=1?r<=1:r>=1;n=e<=1?++r:--r){t=new Particle;if(t.isTarget){this.particlesArray.push(t);this.particlesArrayIds.push(t.id)}else{this.particlesArray.unshift(t);this.particlesArrayIds.unshift(t.id)}}},particleTapDetectionHandler:function(){var e,t,n,r,i,s,o,u,a,f;s=!1;f=this.particlesToTestForTaps.reverse();for(u=0,a=f.length;u<a;u++){r=f[u];i=this.particlesArrayIds.indexOf(r);n=this.particlesArray[i];o=event.touches[0];if(n!=null&&this.particleWasTapped(n,o)){t=this.particlesToTestForTaps.indexOf(r);this.particlesToTestForTaps.splice(t,1);this.removeParticle(i);s=!0;break}}if(s){headsUp.updateScore(n.size,n.finalSize);e=headsUp.comboMultiplier+1}else e=1;headsUp.updateComboMultiplierCounter(e)},particleWasTapped:function(e,t){var n,r,i,s,o,u,a,f;a=t.pageX*devicePixelRatio;f=t.pageY*devicePixelRatio;utils.updateUITextNode(headsUp.tapX,a);utils.updateUITextNode(headsUp.tapY,f);o=e.position.x-e.half;i=o+e.size;n=a>=o&&a<=i;u=e.position.y-e.half;s=u+e.size;r=f>=u&&f<=s;return n&&r},removeParticle:function(e){this.particlesArray.splice(e,1);this.particlesArrayIds.splice(e,1)},reset:function(){},setupParticleTapDetection:function(){var e;e=this;this.particlesToTestForTaps=[];window.addEventListener("touchstart",function(){e.particleTapDetectionHandler()})},start:function(){this.comboMultiplierCounter.text(headsUp.comboMultiplier);this.requestAnimationFrame()},updateValuesAndDraw:function(){var e,t,n,r;r=this.particlesArray;for(t=0,n=r.length;t<n;t++){e=r[t];context.fillStyle=e.color;context.strokeStyle=e.color;e.draw();e.updateValues()}}});Scenes=Class.extend({init:function(){this.splash()},credits:function(){},gameOver:function(){alert("GAME OVER");animationLoop.cancelAnimationFrame();game.reset()},howToPlay:function(){},installationPrompt:function(){$("body").empty().text("ADD THIS TO YOUR HOME SCREEN TO PLAY")},mobilePrompt:function(){$("body").empty().text("YOU NEED TO RUN THIS ON A MOBILE DEVICE, YOU MUG")},splash:function(){},title:function(){}});Utils=Class.extend({init:function(){},correctValueForDPR:function(e,t){t==null&&(t=!1);return t?Math.round(e*devicePixelRatio):e*devicePixelRatio},randomInteger:function(e,t){if(t===void 0){t=e;e=0}return Math.floor(Math.random()*(t+1-e))+e},random:function(e,t){if(e===void 0){e=0;t=1}else if(t===void 0){t=e;e=0}return Math.random()*(t-e)+e},updateUITextNode:function(e,t){var n;n=document.querySelector(e);n.innerHTML=t}});animationLoop=new AnimationLoop;scenes=new Scenes;config=new Config;game=new Game;headsUp=new HeadsUp;input=new Input;particleGenerator=new ParticleGenerator;utils=new Utils;android||homeScreenApp||debug?game.run():iOS?scenes.installationPrompt():scenes.mobilePrompt();