var $,callNativeApp,clamp,correctValueForDPR,debugConsole,formatWithComma,fps,random,randomColor,randomInteger,randomPercentage,rgba,updateUITextNode;$=function(t){var e;return 1===(e=document.querySelectorAll(t)).length?e[0]:e},callNativeApp=function(t){try{return webkit.messageHandlers.callbackHandler.postMessage(t)}catch(t){return t,console.log("The native context does not exist yet")}},clamp=function(t,e,i){return t<e?t=e:t>i&&(t=i),t},correctValueForDPR=function(t,e){return null==e&&(e=!1),t*=devicePixelRatio,e&&(t=Math.round(t)),t},debugConsole=function(t){var e;e=$(".debugConsole"),updateUITextNode(e,t),console.log(t),callNativeApp(t)},formatWithComma=function(t){return t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},fps=function(t){return updateUITextNode($(".fps"),t)},random=function(t,e){return void 0===t?(t=0,e=1):void 0===e&&(e=t,t=0),Math.random()*(e-t)+t},randomColor=function(){var t,e,i;return i=randomInteger(0,200),e=randomInteger(0,200),t=randomInteger(0,200),i+", "+e+", "+t},randomInteger=function(t,e){return void 0===e&&(e=t,t=0),Math.floor(Math.random()*(e+1-t))+t},randomPercentage=function(){return Math.floor(100*Math.random())},rgba=function(t,e){return null==e&&(e=!1),e||(e=1),"rgba("+t+", "+e+")"},updateUITextNode=function(t,e){return t.innerHTML=e,this};var AnimationLoopHelper;AnimationLoopHelper=function(){function t(){return this.animationLoopId=null,this.delta=0,this.fps=0,this.lastTime=0,this}return t.prototype.correctValue=function(t){return t*this.delta*.06},t.prototype.frame=function(t){return this.delta=t-this.lastTime,this.fps=Math.round(1e3/this.delta),this.lastTime=t,fps(this.fps),App.update(this.delta),this.animationLoopId=window.requestAnimationFrame(function(t){return function(e){t.frame(e)}}(this))},t.prototype.start=function(){return this.frame(),this},t.prototype.stop=function(){return window.cancelAnimationFrame(this.animationLoopId),this},t}();var CanvasHelper;CanvasHelper=function(){function t(){}return t.prototype.load=function(){return this.device=App.getHelper("device"),this.input=App.getHelper("input"),this.elementSelector=".canvas",this.createCanvas(),this},t.prototype.clear=function(){return this.context.clearRect(0,0,this.element.width,this.element.height),this},t.prototype.createCanvas=function(){return this.element=document.querySelector(this.elementSelector),this.element.height=this.device.screen.height,this.element.width=this.device.screen.width,this.element.realHeight=this.element.height,this.element.realWidth=this.element.width,this.context=this.element.getContext("2d"),this.context.globalCompositeOperation="destination-atop",this.scaleCanvas(),this.input.addCanvasTapEventListener(this.elementSelector),this},t.prototype.scaleCanvas=function(){var t,e,i,n;return t=this.context.webkitBackingStorePixelRatio||this.context.backingStorePixelRatio||1,this.device.pixelRatio!==t&&(n=this.device.pixelRatio/t,i=this.element.width,e=this.element.height,this.element.width=i*n,this.element.height=e*n,this.element.style.width=i+"px",this.element.style.height=e+"px",this.context.scale(n,n)),this},t}();var ConfigHelper;ConfigHelper=function(){function t(){}return t.prototype.load=function(){return this.values={},this},t.prototype.console=function(t){return debugConsole(this.get(t)),this},t.prototype.dump=function(t){var e;return e=this.values,t&&(e="Config."+t+": "+this.get(t)),console.log(e),this},t.prototype.get=function(t){var e,i,n,r,o,s;for(t=t.split("."),e=this.values,n=i=0,o=t.length;i<o;n=++i)r=t[n],null!=t[n+1]?e=e[r]:s=e[r];if(null!=s)return s},t.prototype.set=function(t,e){var i,n,r,o,s,a;for(t=t.split("."),i=this.values,r=n=0,s=t.length;n<s;r=++n)o=t[r],a=t[r+1],i[o]||(i[o]=null!=a?{}:e),i=i[o];return this},t}();var DeviceHelper;DeviceHelper=function(){return function(){return this.screen={height:document.body.clientHeight,width:document.body.clientWidth},this.android=!!navigator.userAgent.match(/android/i),this.ios=!this.android,this.hasTouchEvents=window.hasOwnProperty("ontouchstart")||window.hasOwnProperty("onmsgesturechange"),this.pixelRatio=window.devicePixelRatio||1,this}}();var InputHelper;InputHelper=function(){function t(){return this.device=new DeviceHelper,this.cancelTouchMoveEvents(),this}return t.prototype.load=function(){return this.entityIds=[],this.entitiesToTest=[],this.entitiesPendingRemoval=[],this},t.prototype.addCanvasTapEventListener=function(t){return this.addEventListener(t,"click",function(t){return function(){t.testEntitiesForEvents()}}(this)),this},t.prototype.addEntity=function(t){return this.entityIds.push(t.id),this.entitiesToTest.push(t),this},t.prototype.addEventListener=function(t,e,i,n){return null==t&&(t="body"),null==n&&(n=!1),e=this.convertClickToTouch(e),n&&debugConsole("Input.addEventListener("+t+", "+e+", "+i+")"),$(t).addEventListener(e,i,!1),this},t.prototype.cancelTouchMoveEvents=function(){return window.addEventListener("touchmove",function(t){t.preventDefault()}),this},t.prototype.convertClickToTouch=function(t){return"click"===t&&this.device.hasTouchEvents?"touchstart":t},t.prototype.getTouchData=function(t){return this.device.hasTouchEvents?{x:t.touches[0].pageX,y:t.touches[0].pageY}:{x:t.clientX,y:t.clientY}},t.prototype.removeEventListener=function(t,e,i){return null==t&&(t="body"),e=this.convertClickToTouch(e),debugConsole("Input.removeEventListener("+t+", "+e+", "+i+")"),$(t).removeEventListener(e,i,!1),this},t.prototype.setupConsole=function(){return this.addEventListener("body","click",function(t){var e,i,n,r;r=t.type,n=t.target.nodeName.toLowerCase(),i=t.target.id||"n/a",e=t.target.classList||"n/a",debugConsole(r+" on "+n+" - id: "+i+" - class: "+e)}),this},t.prototype.queueEntityForRemoval=function(t){return this.entitiesPendingRemoval.push(t),this},t.prototype.removeAllEntities=function(){return this.entitiesToTest=[],this},t.prototype.removeQueuedEntities=function(){var t,e,i,n;for(t=0,i=(n=this.entitiesPendingRemoval).length;t<i;t++)e=n[t],this.removeEntity(e);return this.entitiesPendingRemoval=[],this},t.prototype.removeEntity=function(t){var e;return-1!==(e=this.entityIds.indexOf(t))&&(this.entityIds.splice(e,1),this.entitiesToTest.splice(e,1)),this},t.prototype.testEntitiesForEvents=function(){var t,e,i,n,r;for(this.touchData=this.getTouchData(event),e=0,i=(n=this.entitiesToTest).length;e<i;e++)r=(t=n[e]).wasTapped(),t.tapHandler(r);return this.removeQueuedEntities(),this},t}();var RendererHelper;RendererHelper=function(){function t(){}return t.prototype.load=function(){return this.renderStack=[],this},t.prototype.enqueue=function(t){return this.renderStack.push(t),this},t.prototype.process=function(){var t,e,i,n;for(e=0,i=(n=this.renderStack).length;e<i;e++)(t=n[e]).isInsideCanvasBounds()&&t.render();return this.reset(),this},t.prototype.reset=function(){return this.renderStack=[],this},t}();var UserInterfaceHelper;UserInterfaceHelper=function(){function t(){}return t.prototype.load=function(){return this.elements={},this},t.prototype.element=function(t){return this.elements[t]},t.prototype.removeAllElements=function(t){return this.elements={},this},t.prototype.registerElement=function(t,e){return this.elements[t]=$(e),this},t.prototype.removeElement=function(t){return null!=this.elements[t]&&delete this.elements[t],this},t.prototype.transitionTo=function(t,e){var i;return null==e&&(e=!1),i=App.scenes[t],null!=App.currentScene&&App.currentScene.unload(),i.load(),this.updateBodyClass("scene-"+t),App.currentScene=i,this},t.prototype.updateBodyClass=function(t){return document.body.className="",document.body.classList.add(t),this},t}();var Application;Application=function(){function t(){return this.currentScene=null,this.delta=0,this.helpers={},this.scenes={},this.backgroundScenes=[],this.initHelpers(),this.initScenes(),this}return t.prototype.load=function(){return callNativeApp("PopRush Loaded! Aww Yeah!"),this.getHelper("animationLoop").start(),this.getHelper("ui").transitionTo("ident"),this},t.prototype.initHelpers=function(){var t,e,i,n;for(this.helpers={animationLoop:{object:new AnimationLoopHelper},canvas:{object:new CanvasHelper},config:{object:new ConfigHelper},device:{object:new DeviceHelper},input:{object:new InputHelper},renderer:{object:new RendererHelper},ui:{object:new UserInterfaceHelper}},e=0,i=(n=this.helpers).length;e<i;e++)(t=n[e]).loaded||this.loadHelper(t);return this},t.prototype.loadHelper=function(t){return null!=t.object.load&&t.object.load(),t.loaded=!0,this},t.prototype.initScenes=function(){var t,e,i;this.scenes={ident:new IdentScene,"game-over":new GameOverScene,playing:new PlayingScene,title:new TitleScene},t=this.scenes;for(e in t)(i=t[e]).updatesInBackGround&&this.backgroundScenes.push(i);return this},t.prototype.getHelper=function(t){var e;return(e=this.helpers[t]).loaded||this.loadHelper(e),e.object},t.prototype.update=function(t){var e,i,n,r;if(this.delta=t,null!=this.currentScene){for(this.getHelper("canvas").clear(),this.currentScene.update(),i=0,n=(r=this.backgroundScenes).length;i<n;i++)(e=r[i]).id!==this.currentScene.id&&e.update();this.getHelper("renderer").process()}return this},t}();var Entity;Entity=function(){function t(){return this.animationLoop=App.getHelper("animationLoop"),this.canvas=App.getHelper("canvas"),this.config=App.getHelper("config"),this.input=App.getHelper("input"),this.device=App.getHelper("device"),this.renderer=App.getHelper("renderer"),this.context=this.canvas.context,this.id=null,this.parent=null,this.removeOnCanvasExit=!0,this.height=0,this.width=0,this.position={x:0,y:0},this.velocity={x:0,y:0},this}return t.prototype.addSelfToRenderQueue=function(){return this.renderer.enqueue(this),this},t.prototype.canvasExitCallback=function(){return this},t.prototype.isInsideCanvasBounds=function(){return!this.isOutsideCanvasBounds()},t.prototype.isOutsideCanvasBounds=function(){var t,e,i,n,r,o;return e=this.position.x<-this.width,i=this.position.x-this.width>this.canvas.element.realWidth,r=e||i,n=this.position.y<-this.height,t=this.position.y-this.height>this.canvas.element.realWheight,o=n||t,r||o},t.prototype.removeSelfFromParent=function(){return null!=this.parent&&this.parent.removeEntity(this.id),this},t.prototype.update=function(){return this.isOutsideCanvasBounds()&&(null!=this.canvasExitCallback&&this.canvasExitCallback(),this.removeOnCanvasExit&&this.removeSelfFromParent()),this},t}();var Scene;Scene=function(){function t(){return this.entitiesCount=0,this.entityIds=[],this.entities=[],this.entitiesPendingRemoval=[],this.updatesInBackGround=!1,this}return t.prototype.addEntity=function(t,e){return null==e&&(e=!1),e?(this.entityIds.unshift(t.id),this.entities.unshift(t)):(this.entityIds.push(t.id),this.entities.push(t)),this.entitiesCount+=1,this},t.prototype.load=function(){return this.config=App.getHelper("config"),this.device=App.getHelper("device"),this.input=App.getHelper("input"),this.ui=App.getHelper("ui"),this},t.prototype.removeAllEntities=function(){return this.entitiesCount=0,this.entities=[],this.entityIds=[],this},t.prototype.removeEntity=function(t){return this.entitiesPendingRemoval.push(t),this},t.prototype.unload=function(){return this},t.prototype.update=function(){return this.entitiesCount>0&&(this.updateEntities(),this.processEntitiesMarkedForRemoval()),this},t.prototype.updateEntities=function(){var t,e,i;for(t=0,e=(i=this.entities).length;t<e;t++)i[t].update();return this},t.prototype.processEntitiesMarkedForRemoval=function(){var t,e,i,n,r;for(t=0,n=(r=this.entitiesPendingRemoval).length;t<n;t++)e=r[t],i=this.entityIds.indexOf(e),this.entities.splice(i,1),this.entityIds.splice(i,1),this.entitiesCount-=1;if(this.entitiesPendingRemoval=[],this.entitiesCount<0)return this.entitiesCount=0},t}();var GameOverScene,extend=function(t,e){function i(){this.constructor=t}for(var n in e)hasProp.call(e,n)&&(t[n]=e[n]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},hasProp={}.hasOwnProperty;GameOverScene=function(t){function e(){return e.__super__.constructor.apply(this,arguments),this.id="game-over",this.playAgainEventBound=!1,this}return extend(e,Scene),e.prototype.load=function(){return e.__super__.load.apply(this,arguments),this.input.addEventListener(".play-again","click",function(t){return function(){t.ui.transitionTo("playing")}}(this)),this},e}();var IdentScene,extend=function(t,e){function i(){this.constructor=t}for(var n in e)hasProp.call(e,n)&&(t[n]=e[n]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},hasProp={}.hasOwnProperty;IdentScene=function(t){function e(){return e.__super__.constructor.apply(this,arguments),this.id="ident",this}return extend(e,Scene),e.prototype.load=function(){return e.__super__.load.apply(this,arguments),window.setTimeout(function(t){return function(){return t.ui.transitionTo("title")}}(this),2500),this},e}();var PlayingScene,extend=function(t,e){function i(){this.constructor=t}for(var n in e)hasProp.call(e,n)&&(t[n]=e[n]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},hasProp={}.hasOwnProperty;PlayingScene=function(t){function e(){return e.__super__.constructor.apply(this,arguments),this.id="playing",this.updatesInBackGround=!0,this.levelUpInterval=5e3,this.maxLevel=50,this.maxDiameterAsPercentageOfScreen=15,this.maxLineWidth=5,this.pointsPerPop=10,this}return extend(e,Scene),e.prototype.load=function(){return e.__super__.load.apply(this,arguments),this.ui.registerElement("comboMultiplierCounter",".hud-value-combo"),this.ui.registerElement("levelCounter",".hud-value-level"),this.ui.registerElement("scoreCounter",".hud-value-score"),this.comboMultiplier=0,this.level=1,this.score=0,this.setupLevelUpIncrement(),this.setHeadsUpValues(),this.targetBubblesCount=0,this.playing=!0,this.setupDifficultyConfig(),this},e.prototype.decrementTargetBubblesCount=function(){return this.targetBubblesCount-=1,this.targetBubblesCount<0&&(this.targetBubblesCount=0),this},e.prototype.gameOver=function(){return this.ui.transitionTo("game-over"),this.input.removeAllEntities(),this},e.prototype.generateBubble=function(){var t,e;return this.playing&&randomPercentage()<this.difficultyConfig.bubbleSpawnChance.current&&(e=this.newBubbleConfig(),(t=new BubbleEntity(this,e)).isTarget?(this.addEntity(t),this.input.addEntity(t)):this.addEntity(t,!0),t.isTarget&&(this.targetBubblesCount+=1)),this},e.prototype.newBubbleConfig=function(){return{bubbleGrowthMultiplier:this.difficultyConfig.bubbleGrowthMultiplier.current,chanceBubbleIsTarget:this.difficultyConfig.chanceBubbleIsTarget.current,diameterMax:this.difficultyConfig.diameterMax.current,maxTargetsAtOnce:this.difficultyConfig.maxTargetsAtOnce.current,minTargetDiameter:this.difficultyConfig.minTargetDiameter.current,targetVelocityMultiplier:this.difficultyConfig.targetVelocityMultiplier.current,velocityMax:this.difficultyConfig.velocityMax.current,velocityMin:this.difficultyConfig.velocityMin.current,maxLineWidth:this.maxLineWidth,playing:this.playing,targetBubblesCount:this.targetBubblesCount}},e.prototype.setupDifficultyConfig=function(){var t;return t=this.device.screen.width/100*this.maxDiameterAsPercentageOfScreen,this.difficultyConfig={bubbleGrowthMultiplier:{current:0,easy:1.05,difficult:1.1},bubbleSpawnChance:{current:0,easy:60,difficult:100},chanceBubbleIsTarget:{current:0,easy:50,difficult:90},diameterMax:{current:0,easy:t,difficult:.6*t},maxTargetsAtOnce:{current:0,easy:3,difficult:6},minTargetDiameter:{current:0,easy:.7*t,difficult:.4*t},targetVelocityMultiplier:{current:0,easy:.3,difficult:.5},velocityMax:{current:0,easy:4,difficult:7},velocityMin:{current:0,easy:-4,difficult:-7}},this.updateValuesForDifficulty(),this},e.prototype.setHeadsUpValues=function(){return updateUITextNode(this.ui.element("comboMultiplierCounter"),this.comboMultiplier),updateUITextNode(this.ui.element("levelCounter"),this.level),updateUITextNode(this.ui.element("scoreCounter"),formatWithComma(this.score)),this},e.prototype.setupLevelUpIncrement=function(){return this.levelUpCounter=window.setInterval(function(t){return function(){t.updateLevel()}}(this),this.levelUpInterval),this},e.prototype.stopLevelUpIncrement=function(){return window.clearInterval(this.levelUpCounter),this},e.prototype.unload=function(){var t,e,i;if(!0===this.playing){for(t=0,e=(i=this.entities).length;t<e;t++)i[t].destroying=!0;return this.playing=!1,this.stopLevelUpIncrement()}},e.prototype.update=function(){return e.__super__.update.apply(this,arguments),this.generateBubble(),this},e.prototype.updateComboMultiplier=function(t){return t?this.comboMultiplier+=1:this.comboMultiplier=0,this.setHeadsUpValues(),this},e.prototype.updateLevel=function(){return this.level+=1,this.level>=this.maxLevel&&window.clearInterval(this.levelUpCounter),this.setHeadsUpValues(),this.updateValuesForDifficulty(),this},e.prototype.updateScore=function(t,e){var i,n,r;return r=Math.round(100-t/e*100),n=this.pointsPerPop+r,i=this.level+1,this.score+=n*this.comboMultiplier*i,this.setHeadsUpValues(),this},e.prototype.updateValuesForDifficulty=function(){var t,e,i,n,r;e=this.level/this.maxLevel,r=this.difficultyConfig;for(i in r)t=((n=r[i]).difficult-n.easy)*e+n.easy,this.difficultyConfig[i].current=t;return this},e}();var TitleScene,extend=function(t,e){function i(){this.constructor=t}for(var n in e)hasProp.call(e,n)&&(t[n]=e[n]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},hasProp={}.hasOwnProperty;TitleScene=function(t){function e(){return e.__super__.constructor.apply(this,arguments),this.id="title",this}return extend(e,Scene),e.prototype.load=function(){return e.__super__.load.apply(this,arguments),this.input.addEventListener(".game-logo","click",function(t){return function(){t.ui.transitionTo("playing")}}(this)),this},e.prototype.unload=function(){return e.__super__.unload.apply(this,arguments),this},e}();var BubbleEntity,extend=function(t,e){function i(){this.constructor=t}for(var n in e)hasProp.call(e,n)&&(t[n]=e[n]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},hasProp={}.hasOwnProperty;BubbleEntity=function(t){function e(t,i){return e.__super__.constructor.apply(this,arguments),this.parent=t,this.configValues=i,this.height=0,this.id="bubble_"+Math.random().toString(36).substr(2,5),this.position={x:this.device.screen.width/2,y:this.device.screen.height/2},this.velocity={x:random(this.configValues.velocityMin,this.configValues.velocityMax),y:random(this.configValues.velocityMin,this.configValues.velocityMax)},this.width=0,this.alpha=.75,this.color=randomColor(),this.destroying=!1,this.diameter=1,this.fillColor=this.color,this.strokeColor=this.color,this.finalDiameter=randomInteger(0,i.diameterMax),this.isTarget=this.determineTargetBubble(),this.radius=.5,this.shrinkMultiplier=.9,this.isTarget&&(this.alpha=.9,this.fillColor="240, 240, 240",this.finalDiameter=randomInteger(this.configValues.minTargetDiameter,this.configValues.diameterMax),this.lineWidth=this.diameter/10,this.velocity.x*=this.configValues.targetVelocityMultiplier,this.velocity.y*=this.configValues.targetVelocityMultiplier),this}return extend(e,Entity),e.prototype.canvasExitCallback=function(){return e.__super__.canvasExitCallback.apply(this,arguments),this.isTarget&&this.parent.gameOver(),this},e.prototype.determineTargetBubble=function(){return this.configValues.targetBubblesCount<this.configValues.maxTargetsAtOnce&&randomPercentage()<this.configValues.chanceBubbleIsTarget},e.prototype.render=function(){return this.context.lineWidth=this.lineWidth,this.context.fillStyle=rgba(this.fillColor,this.alpha),this.context.strokeStyle=rgba(this.strokeColor,this.alpha),this.context.beginPath(),this.context.arc(this.position.x,this.position.y,this.radius,0,2*Math.PI,!0),this.context.fill(),this.isTarget&&this.context.stroke(),this.context.closePath(),this},e.prototype.tapHandler=function(t){return this.parent.updateComboMultiplier(t),t&&(this.parent.updateScore(this.diameter,this.finalDiameter),this.destroying=!0,this.parent.decrementTargetBubblesCount(),this.input.queueEntityForRemoval(this.id)),this},e.prototype.update=function(){return e.__super__.update.apply(this,arguments),this.destroying?(this.diameter*=this.parent.playing?.6:this.shrinkMultiplier,this.diameter<1&&this.removeSelfFromParent()):this.diameter<this.finalDiameter&&(this.diameter*=this.configValues.bubbleGrowthMultiplier),this.diameter=clamp(this.diameter,0,this.finalDiameter),this.isTarget&&(this.lineWidth=clamp(this.diameter/10,0,this.configValues.maxLineWidth)),this.height=this.diameter,this.width=this.diameter,this.radius=this.diameter/2,this.position.x+=this.animationLoop.correctValue(this.velocity.x),this.position.y+=this.animationLoop.correctValue(this.velocity.y),this.addSelfToRenderQueue(),this},e.prototype.wasTapped=function(){var t,e,i,n,r,o,s;return s=this.input.touchData,n=s.x,r=s.y,t=n-this.position.x,e=r-this.position.y,o=t*t+e*e<this.radius*this.radius,i=o?"Bubble#"+this.id+" tapped at "+n+", "+r:"Combo Broken!",debugConsole(i),o},e}();var App;(App=new Application).load();
//# sourceMappingURL=application.js.map
