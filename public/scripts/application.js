"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var $=function(e){var t=document.querySelectorAll(e);return 1===t.length?t[0]:t},callNativeApp=function(e){try{return webkit.messageHandlers.callbackHandler.postMessage(e)}catch(e){return console.log("The native context does not exist yet")}},clamp=function(e,t,n){return e<t?e=t:e>n&&(e=n),e},correctValueForDPR=function(e,t){return null==t&&(t=!1),e*=devicePixelRatio,t&&(e=Math.round(e)),e},debugConsole=function(e){var t=$(".debugConsole");updateUITextNode(t,e),console.log(e),callNativeApp(e)},formatWithComma=function(e){return e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},fps=function(e){return updateUITextNode($(".fps"),e)},random=function(e,t){return void 0===e?(e=0,t=1):void 0===t&&(t=e,e=0),Math.random()*(t-e)+e},randomColor=function(){return randomInteger(0,200)+", "+randomInteger(0,200)+", "+randomInteger(0,200)},randomInteger=function(e,t){return void 0===t&&(t=e,e=0),Math.floor(Math.random()*(t+1-e))+e},randomPercentage=function(){return Math.floor(100*Math.random())},rgba=function(e,t){return null==t&&(t=!1),t||(t=1),"rgba("+e+", "+t+")"},updateUITextNode=function(e,t){return e.innerHTML=t,this},_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),AnimationLoopHelper=function(){function e(){return _classCallCheck(this,e),this.animationLoopId=null,this.delta=0,this.fps=0,this.lastTime=0,this}return _createClass(e,[{key:"correctValue",value:function(e){return e*this.delta*.06}},{key:"frame",value:function(e){var t=this;return this.delta=e-this.lastTime,this.fps=Math.round(1e3/this.delta),this.lastTime=e,fps(this.fps),App.update(this.delta),this.animationLoopId=window.requestAnimationFrame(function(e){t.frame(e)})}},{key:"start",value:function(){return this.frame(),this}},{key:"stop",value:function(){return window.cancelAnimationFrame(this.animationLoopId),this}}]),e}(),_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),CanvasHelper=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"load",value:function(){return this.device=App.getHelper("device"),this.input=App.getHelper("input"),this.elementSelector=".canvas",this.createCanvas(),this}},{key:"clear",value:function(){return this.context.clearRect(0,0,this.element.width,this.element.height),this}},{key:"createCanvas",value:function(){return this.element=document.querySelector(this.elementSelector),this.element.height=this.device.screen.height,this.element.width=this.device.screen.width,this.element.realHeight=this.element.height,this.element.realWidth=this.element.width,this.context=this.element.getContext("2d"),this.context.globalCompositeOperation="destination-atop",this.scaleCanvas(),this.input.addCanvasTapEventListener(this.elementSelector),this}},{key:"scaleCanvas",value:function(){var e=this.context.webkitBackingStorePixelRatio||this.context.backingStorePixelRatio||1;if(this.device.pixelRatio!==e){var t=this.device.pixelRatio/e,n=this.element.width,i=this.element.height;this.element.width=n*t,this.element.height=i*t,this.element.style.width=n+"px",this.element.style.height=i+"px",this.context.scale(t,t)}return this}}]),e}(),_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),ConfigHelper=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"load",value:function(){return this.values={},this}},{key:"console",value:function(e){return debugConsole(this.get(e)),this}},{key:"dump",value:function(e){var t=this.values;return e&&(t="Config."+e+": "+this.get(e)),console.log(t),this}},{key:"get",value:function(e){var t=void 0;e=e.split(".");for(var n=this.values,i=0;i<e.length;i++){var r=e[i];null!=e[i+1]?n=n[r]:t=n[r]}if(null!=t)return t}},{key:"set",value:function(e,t){e=e.split(".");for(var n=this.values,i=0;i<e.length;i++){var r=e[i],o=e[i+1];n[r]||(n[r]=null!=o?{}:t),n=n[r]}return this}}]),e}(),DeviceHelper=function e(){return _classCallCheck(this,e),this.screen={height:document.body.clientHeight,width:document.body.clientWidth},this.android=Boolean(navigator.userAgent.match(/android/i)),this.ios=!this.android,this.hasTouchEvents=window.hasOwnProperty("ontouchstart")||window.hasOwnProperty("onmsgesturechange"),this.pixelRatio=window.devicePixelRatio||1,this},_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),InputHelper=function(){function e(){return _classCallCheck(this,e),this.device=new DeviceHelper,this.cancelTouchMoveEvents(),this}return _createClass(e,[{key:"load",value:function(){return this.entityIds=[],this.entitiesToTest=[],this.entitiesPendingRemoval=[],this}},{key:"addCanvasTapEventListener",value:function(e){var t=this;return this.addEventListener(e,"click",function(){t.testEntitiesForEvents()}),this}},{key:"addEntity",value:function(e){return this.entityIds.push(e.id),this.entitiesToTest.push(e),this}},{key:"addEventListener",value:function(e,t,n,i){return null==e&&(e="body"),null==i&&(i=!1),t=this.convertClickToTouch(t),i&&debugConsole("Input.addEventListener("+e+", "+t+", "+n+")"),$(e).addEventListener(t,n,!1),this}},{key:"cancelTouchMoveEvents",value:function(){return window.addEventListener("touchmove",function(e){e.preventDefault()}),this}},{key:"convertClickToTouch",value:function(e){return"click"===e&&this.device.hasTouchEvents?"touchstart":e}},{key:"getTouchData",value:function(e){return this.device.hasTouchEvents?{x:e.touches[0].pageX,y:e.touches[0].pageY}:{x:e.clientX,y:e.clientY}}},{key:"removeEventListener",value:function(e,t,n){return null==e&&(e="body"),t=this.convertClickToTouch(t),debugConsole("Input.removeEventListener("+e+", "+t+", "+n+")"),$(e).removeEventListener(t,n,!1),this}},{key:"setupConsole",value:function(){return this.addEventListener("body","click",function(e){var t=e.type,n=e.target.nodeName.toLowerCase(),i=e.target.id||"n/a",r=e.target.classList||"n/a";debugConsole(t+" on "+n+" - id: "+i+" - class: "+r)}),this}},{key:"queueEntityForRemoval",value:function(e){return this.entitiesPendingRemoval.push(e),this}},{key:"removeAllEntities",value:function(){return this.entitiesToTest=[],this}},{key:"removeQueuedEntities",value:function(){var e=!0,t=!1,n=void 0;try{for(var i,r=Array.from(this.entitiesPendingRemoval)[Symbol.iterator]();!(e=(i=r.next()).done);e=!0){var o=i.value;this.removeEntity(o)}}catch(e){t=!0,n=e}finally{try{!e&&r.return&&r.return()}finally{if(t)throw n}}return this.entitiesPendingRemoval=[],this}},{key:"removeEntity",value:function(e){var t=this.entityIds.indexOf(e);return-1!==t&&(this.entityIds.splice(t,1),this.entitiesToTest.splice(t,1)),this}},{key:"testEntitiesForEvents",value:function(){this.touchData=this.getTouchData(event);var e=!0,t=!1,n=void 0;try{for(var i,r=Array.from(this.entitiesToTest)[Symbol.iterator]();!(e=(i=r.next()).done);e=!0){var o=i.value,a=o.wasTapped();o.tapHandler(a)}}catch(e){t=!0,n=e}finally{try{!e&&r.return&&r.return()}finally{if(t)throw n}}return this.removeQueuedEntities(),this}}]),e}(),_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),RendererHelper=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"load",value:function(){return this.renderStack=[],this}},{key:"enqueue",value:function(e){return this.renderStack.push(e),this}},{key:"process",value:function(){var e=!0,t=!1,n=void 0;try{for(var i,r=Array.from(this.renderStack)[Symbol.iterator]();!(e=(i=r.next()).done);e=!0){var o=i.value;o.isInsideCanvasBounds()&&o.render()}}catch(e){t=!0,n=e}finally{try{!e&&r.return&&r.return()}finally{if(t)throw n}}return this.reset(),this}},{key:"reset",value:function(){return this.renderStack=[],this}}]),e}(),_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),UserInterfaceHelper=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"load",value:function(){return this.elements={},this}},{key:"element",value:function(e){return this.elements[e]}},{key:"removeAllElements",value:function(e){return this.elements={},this}},{key:"registerElement",value:function(e,t){return this.elements[e]=$(t),this}},{key:"removeElement",value:function(e){return null!=this.elements[e]&&delete this.elements[e],this}},{key:"transitionTo",value:function(e,t){null==t&&(t=!1);var n=App.scenes[e];return null!=App.currentScene&&App.currentScene.unload(),n.load(),this.updateBodyClass("scene-"+e),App.currentScene=n,this}},{key:"updateBodyClass",value:function(e){return document.body.className="",document.body.classList.add(e),this}}]),e}(),_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),Application=function(){function e(){return _classCallCheck(this,e),this.currentScene=null,this.delta=0,this.helpers={},this.scenes={},this.backgroundScenes=[],this.initHelpers(),this.initScenes(),this}return _createClass(e,[{key:"load",value:function(){return callNativeApp("PopRush Loaded! Aww Yeah!"),this.getHelper("animationLoop").start(),this.getHelper("ui").transitionTo("ident"),this}},{key:"initHelpers",value:function(){this.helpers={animationLoop:{object:new AnimationLoopHelper},canvas:{object:new CanvasHelper},config:{object:new ConfigHelper},device:{object:new DeviceHelper},input:{object:new InputHelper},renderer:{object:new RendererHelper},ui:{object:new UserInterfaceHelper}};var e=!0,t=!1,n=void 0;try{for(var i,r=Array.from(this.helpers)[Symbol.iterator]();!(e=(i=r.next()).done);e=!0){var o=i.value;o.loaded||this.loadHelper(o)}}catch(e){t=!0,n=e}finally{try{!e&&r.return&&r.return()}finally{if(t)throw n}}return this}},{key:"loadHelper",value:function(e){return null!==e.object.load&&e.object.load(),e.loaded=!0,this}},{key:"initScenes",value:function(){this.scenes={ident:new IdentScene,"game-over":new GameOverScene,playing:new PlayingScene,title:new TitleScene};for(var e in this.scenes){var t=this.scenes[e];t.updatesInBackGround&&this.backgroundScenes.push(t)}return this}},{key:"getHelper",value:function(e){var t=this.helpers[e];return t.loaded||this.loadHelper(t),t.object}},{key:"update",value:function(e){if(this.delta=e,null!=this.currentScene){this.getHelper("canvas").clear(),this.currentScene.update();var t=!0,n=!1,i=void 0;try{for(var r,o=Array.from(this.backgroundScenes)[Symbol.iterator]();!(t=(r=o.next()).done);t=!0){var a=r.value;a.id!==this.currentScene.id&&a.update()}}catch(e){n=!0,i=e}finally{try{!t&&o.return&&o.return()}finally{if(n)throw i}}this.getHelper("renderer").process()}return this}}]),e}(),_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),Entity=function(){function e(){return _classCallCheck(this,e),this.animationLoop=App.getHelper("animationLoop"),this.canvas=App.getHelper("canvas"),this.config=App.getHelper("config"),this.input=App.getHelper("input"),this.device=App.getHelper("device"),this.renderer=App.getHelper("renderer"),this.context=this.canvas.context,this.id=null,this.parent=null,this.removeOnCanvasExit=!0,this.height=0,this.width=0,this.position={x:0,y:0},this.velocity={x:0,y:0},this}return _createClass(e,[{key:"addSelfToRenderQueue",value:function(){return this.renderer.enqueue(this),this}},{key:"canvasExitCallback",value:function(){return this}},{key:"isInsideCanvasBounds",value:function(){return!this.isOutsideCanvasBounds()}},{key:"isOutsideCanvasBounds",value:function(){var e=this.position.x<-this.width,t=this.position.x-this.width>this.canvas.element.realWidth,n=e||t,i=this.position.y<-this.height,r=this.position.y-this.height>this.canvas.element.realWheight,o=i||r;return n||o}},{key:"removeSelfFromParent",value:function(){return null!=this.parent&&this.parent.removeEntity(this.id),this}},{key:"update",value:function(){return this.isOutsideCanvasBounds()&&(null!=this.canvasExitCallback&&this.canvasExitCallback(),this.removeOnCanvasExit&&this.removeSelfFromParent()),this}}]),e}(),_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),Scene=function(){function e(){return _classCallCheck(this,e),this.entitiesCount=0,this.entityIds=[],this.entities=[],this.entitiesPendingRemoval=[],this.updatesInBackGround=!1,this}return _createClass(e,[{key:"addEntity",value:function(e,t){return null===t?(this.entityIds.push(e.id),this.entities.push(e)):(this.entityIds.unshift(e.id),this.entities.unshift(e)),this.entitiesCount+=1,this}},{key:"load",value:function(){return this.config=App.getHelper("config"),this.device=App.getHelper("device"),this.input=App.getHelper("input"),this.ui=App.getHelper("ui"),this}},{key:"removeAllEntities",value:function(){return this.entitiesCount=0,this.entities=[],this.entityIds=[],this}},{key:"removeEntity",value:function(e){return this.entitiesPendingRemoval.push(e),this}},{key:"unload",value:function(){return this}},{key:"update",value:function(){return this.entitiesCount>0&&(this.updateEntities(),this.processEntitiesMarkedForRemoval()),this}},{key:"updateEntities",value:function(){var e=!0,t=!1,n=void 0;try{for(var i,r=Array.from(this.entities)[Symbol.iterator]();!(e=(i=r.next()).done);e=!0)i.value.update()}catch(e){t=!0,n=e}finally{try{!e&&r.return&&r.return()}finally{if(t)throw n}}return this}},{key:"processEntitiesMarkedForRemoval",value:function(){var e=!0,t=!1,n=void 0;try{for(var i,r=Array.from(this.entitiesPendingRemoval)[Symbol.iterator]();!(e=(i=r.next()).done);e=!0){var o=i.value,a=this.entityIds.indexOf(o);this.entities.splice(a,1),this.entityIds.splice(a,1),this.entitiesCount-=1}}catch(e){t=!0,n=e}finally{try{!e&&r.return&&r.return()}finally{if(t)throw n}}if(this.entitiesPendingRemoval=[],this.entitiesCount<0)return this.entitiesCount=0}}]),e}(),_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),_get=function e(t,n,i){null===t&&(t=Function.prototype);var r=Object.getOwnPropertyDescriptor(t,n);if(void 0===r){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,i)}if("value"in r)return r.value;var a=r.get;if(void 0!==a)return a.call(i)},GameOverScene=function(e){function t(){var e;_classCallCheck(this,t);var n=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments));return n.id="game-over",n.playAgainEventBound=!1,e=n,_possibleConstructorReturn(n,e)}return _inherits(t,Scene),_createClass(t,[{key:"load",value:function(){var e=this;return _get(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"load",this).apply(this,arguments),this.input.addEventListener(".play-again","click",function(){e.ui.transitionTo("playing")}),this}}]),t}(),_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),_get=function e(t,n,i){null===t&&(t=Function.prototype);var r=Object.getOwnPropertyDescriptor(t,n);if(void 0===r){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,i)}if("value"in r)return r.value;var a=r.get;if(void 0!==a)return a.call(i)},IdentScene=function(e){function t(){var e;_classCallCheck(this,t);var n=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments));return n.id="ident",e=n,_possibleConstructorReturn(n,e)}return _inherits(t,Scene),_createClass(t,[{key:"load",value:function(){var e=this;return _get(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"load",this).apply(this,arguments),window.setTimeout(function(){return e.ui.transitionTo("title")},2500),this}}]),t}(),_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),_get=function e(t,n,i){null===t&&(t=Function.prototype);var r=Object.getOwnPropertyDescriptor(t,n);if(void 0===r){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,i)}if("value"in r)return r.value;var a=r.get;if(void 0!==a)return a.call(i)},PlayingScene=function(e){function t(){var e;_classCallCheck(this,t);var n=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments));return n.id="playing",n.updatesInBackGround=!0,n.levelUpInterval=5e3,n.maxLevel=50,n.maxDiameterAsPercentageOfScreen=15,n.maxLineWidth=5,n.pointsPerPop=10,e=n,_possibleConstructorReturn(n,e)}return _inherits(t,Scene),_createClass(t,[{key:"load",value:function(){return _get(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"load",this).apply(this,arguments),this.ui.registerElement("comboMultiplierCounter",".hud-value-combo"),this.ui.registerElement("levelCounter",".hud-value-level"),this.ui.registerElement("scoreCounter",".hud-value-score"),this.comboMultiplier=0,this.level=1,this.score=0,this.setupLevelUpIncrement(),this.setHeadsUpValues(),this.targetBubblesCount=0,this.playing=!0,this.setupDifficultyConfig(),this}},{key:"decrementTargetBubblesCount",value:function(){return this.targetBubblesCount-=1,this.targetBubblesCount<0&&(this.targetBubblesCount=0),this}},{key:"gameOver",value:function(){return this.ui.transitionTo("game-over"),this.input.removeAllEntities(),this}},{key:"generateBubble",value:function(){if(this.playing&&randomPercentage()<this.difficultyConfig.bubbleSpawnChance.current){var e=this.newBubbleConfig(),t=new BubbleEntity(this,e);t.isTarget?(this.addEntity(t),this.input.addEntity(t)):this.addEntity(t,!0),t.isTarget&&(this.targetBubblesCount+=1)}return this}},{key:"newBubbleConfig",value:function(){return{bubbleGrowthMultiplier:this.difficultyConfig.bubbleGrowthMultiplier.current,chanceBubbleIsTarget:this.difficultyConfig.chanceBubbleIsTarget.current,diameterMax:this.difficultyConfig.diameterMax.current,maxTargetsAtOnce:this.difficultyConfig.maxTargetsAtOnce.current,minTargetDiameter:this.difficultyConfig.minTargetDiameter.current,targetVelocityMultiplier:this.difficultyConfig.targetVelocityMultiplier.current,velocityMax:this.difficultyConfig.velocityMax.current,velocityMin:this.difficultyConfig.velocityMin.current,maxLineWidth:this.maxLineWidth,playing:this.playing,targetBubblesCount:this.targetBubblesCount}}},{key:"setupDifficultyConfig",value:function(){var e=this.device.screen.width/100*this.maxDiameterAsPercentageOfScreen;return this.difficultyConfig={bubbleGrowthMultiplier:{current:0,easy:1.05,difficult:1.1},bubbleSpawnChance:{current:0,easy:60,difficult:100},chanceBubbleIsTarget:{current:0,easy:50,difficult:90},diameterMax:{current:0,easy:e,difficult:.6*e},maxTargetsAtOnce:{current:0,easy:3,difficult:6},minTargetDiameter:{current:0,easy:.7*e,difficult:.4*e},targetVelocityMultiplier:{current:0,easy:.3,difficult:.5},velocityMax:{current:0,easy:4,difficult:7},velocityMin:{current:0,easy:-4,difficult:-7}},this.updateValuesForDifficulty(),this}},{key:"setHeadsUpValues",value:function(){return updateUITextNode(this.ui.element("comboMultiplierCounter"),this.comboMultiplier),updateUITextNode(this.ui.element("levelCounter"),this.level),updateUITextNode(this.ui.element("scoreCounter"),formatWithComma(this.score)),this}},{key:"setupLevelUpIncrement",value:function(){var e=this;return this.levelUpCounter=window.setInterval(function(){e.updateLevel()},this.levelUpInterval),this}},{key:"stopLevelUpIncrement",value:function(){return window.clearInterval(this.levelUpCounter),this}},{key:"unload",value:function(){if(!0===this.playing){var e=!0,t=!1,n=void 0;try{for(var i,r=Array.from(this.entities)[Symbol.iterator]();!(e=(i=r.next()).done);e=!0)i.value.destroying=!0}catch(e){t=!0,n=e}finally{try{!e&&r.return&&r.return()}finally{if(t)throw n}}return this.playing=!1,this.stopLevelUpIncrement()}}},{key:"update",value:function(){return _get(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"update",this).apply(this,arguments),this.generateBubble(),this}},{key:"updateComboMultiplier",value:function(e){return e?this.comboMultiplier+=1:this.comboMultiplier=0,this.setHeadsUpValues(),this}},{key:"updateLevel",value:function(){return this.level+=1,this.level>=this.maxLevel&&window.clearInterval(this.levelUpCounter),this.setHeadsUpValues(),this.updateValuesForDifficulty(),this}},{key:"updateScore",value:function(e,t){var n=Math.round(100-e/t*100),i=this.pointsPerPop+n,r=this.level+1;return this.score+=i*this.comboMultiplier*r,this.setHeadsUpValues(),this}},{key:"updateValuesForDifficulty",value:function(){var e=this.level/this.maxLevel;for(var t in this.difficultyConfig){var n=this.difficultyConfig[t],i=(n.difficult-n.easy)*e+n.easy;this.difficultyConfig[t].current=i}return this}}]),t}(),_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),_get=function e(t,n,i){null===t&&(t=Function.prototype);var r=Object.getOwnPropertyDescriptor(t,n);if(void 0===r){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,i)}if("value"in r)return r.value;var a=r.get;if(void 0!==a)return a.call(i)},TitleScene=function(e){function t(){var e;_classCallCheck(this,t);var n=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments));return n.id="title",e=n,_possibleConstructorReturn(n,e)}return _inherits(t,Scene),_createClass(t,[{key:"load",value:function(){var e=this;return _get(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"load",this).apply(this,arguments),this.input.addEventListener(".game-logo","click",function(){e.ui.transitionTo("playing")}),this}},{key:"unload",value:function(){return _get(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"unload",this).apply(this,arguments),this}}]),t}(),_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),_get=function e(t,n,i){null===t&&(t=Function.prototype);var r=Object.getOwnPropertyDescriptor(t,n);if(void 0===r){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,i)}if("value"in r)return r.value;var a=r.get;if(void 0!==a)return a.call(i)},BubbleEntity=function(e){function t(e,n){var i;_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments));return r.parent=e,r.configValues=n,r.height=0,r.id="bubble_"+Math.random().toString(36).substr(2,5),r.position={x:r.device.screen.width/2,y:r.device.screen.height/2},r.velocity={x:random(r.configValues.velocityMin,r.configValues.velocityMax),y:random(r.configValues.velocityMin,r.configValues.velocityMax)},r.width=0,r.alpha=.75,r.color=randomColor(),r.destroying=!1,r.diameter=1,r.fillColor=r.color,r.strokeColor=r.color,r.finalDiameter=randomInteger(0,n.diameterMax),r.isTarget=r.determineTargetBubble(),r.radius=.5,r.shrinkMultiplier=.9,r.isTarget&&(r.alpha=.9,r.fillColor="240, 240, 240",r.finalDiameter=randomInteger(r.configValues.minTargetDiameter,r.configValues.diameterMax),r.lineWidth=r.diameter/10,r.velocity.x*=r.configValues.targetVelocityMultiplier,r.velocity.y*=r.configValues.targetVelocityMultiplier),i=r,_possibleConstructorReturn(r,i)}return _inherits(t,Entity),_createClass(t,[{key:"canvasExitCallback",value:function(){return _get(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"canvasExitCallback",this).apply(this,arguments),this.isTarget&&this.parent.gameOver(),this}},{key:"determineTargetBubble",value:function(){return this.configValues.targetBubblesCount<this.configValues.maxTargetsAtOnce&&randomPercentage()<this.configValues.chanceBubbleIsTarget}},{key:"render",value:function(){return this.context.lineWidth=this.lineWidth,this.context.fillStyle=rgba(this.fillColor,this.alpha),this.context.strokeStyle=rgba(this.strokeColor,this.alpha),this.context.beginPath(),this.context.arc(this.position.x,this.position.y,this.radius,0,2*Math.PI,!0),this.context.fill(),this.isTarget&&this.context.stroke(),this.context.closePath(),this}},{key:"tapHandler",value:function(e){return this.parent.updateComboMultiplier(e),e&&(this.parent.updateScore(this.diameter,this.finalDiameter),this.destroying=!0,this.parent.decrementTargetBubblesCount(),this.input.queueEntityForRemoval(this.id)),this}},{key:"update",value:function(){return _get(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"update",this).apply(this,arguments),this.destroying?(this.diameter*=this.parent.playing?.6:this.shrinkMultiplier,this.diameter<1&&this.removeSelfFromParent()):this.diameter<this.finalDiameter&&(this.diameter*=this.configValues.bubbleGrowthMultiplier),this.diameter=clamp(this.diameter,0,this.finalDiameter),this.isTarget&&(this.lineWidth=clamp(this.diameter/10,0,this.configValues.maxLineWidth)),this.height=this.diameter,this.width=this.diameter,this.radius=this.diameter/2,this.position.x+=this.animationLoop.correctValue(this.velocity.x),this.position.y+=this.animationLoop.correctValue(this.velocity.y),this.addSelfToRenderQueue(),this}},{key:"wasTapped",value:function(){var e=void 0,t=this.input.touchData,n=t.x,i=t.y,r=n-this.position.x,o=i-this.position.y,a=r*r+o*o<this.radius*this.radius;return e=a?"Bubble#"+this.id+" tapped at "+n+", "+i:"Combo Broken!",debugConsole(e),a}}]),t}(),App=new Application;App.load();
//# sourceMappingURL=application.js.map
